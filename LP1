#include <iostream>
#include <fstream>
#include <map>
#include <iomanip>
using namespace std;

int main() {
    ifstream fin("input.txt");
    ofstream symout("symbol_table.txt"), inter("intermediate.txt"), mach("machine_code.txt");

    string label, opcode, operand;
    map<string, int> SYMTAB;
    map<string, string> OPTAB = {
        {"START","--"},{"MOVER","01"},{"MOVEM","02"},{"ADD","03"},
        {"SUB","04"},{"MULT","05"},{"DIV","06"},{"DC","00"},{"DS","00"},{"END","--"}
    };

    int LC = 0;
    inter << "LC\tLABEL\tOPCODE\tOPERAND\n";
    mach << "LC\tMACHINE CODE\n";

    while (fin >> label >> opcode >> operand) {
        if (opcode == "START") {
            LC = stoi(operand);
            inter << LC << "\t" << label << "\t" << opcode << "\t" << operand << "\n";
            continue;
        }

        inter << LC << "\t" << label << "\t" << opcode << "\t" << operand << "\n";
        if (label != "**") SYMTAB[label] = LC;

        if (opcode == "DC") {
            mach << LC << "\t00\t" << operand << "\n";
            LC++;
        } 
        else if (opcode == "DS") {
            mach << LC << "\t00\t" << operand << "\n";
            LC += stoi(operand);
        }
        else if (opcode == "END") {
            mach << LC << "\t--\n";
            break;
        } 
        else {
            string reg = "-", var = operand;
            size_t pos = operand.find(',');
            if (pos != string::npos) {
                reg = operand.substr(0, pos);
                var = operand.substr(pos + 1);
            }
            mach << LC << "\t" << OPTAB[opcode] << "\t" << reg << "\t" << var << "\n";
            LC++;
        }
    }

    symout << "Symbol\tAddress\n";
    for (auto &s : SYMTAB) symout << s.first << "\t" << s.second << "\n";

    cout << " Intermediate Code: intermediate.txt\n";
    cout << " Symbol Table: symbol_table.txt\n";
    cout << " Machine Code: machine_code.txt\n";

    fin.close();
    symout.close();
    inter.close();
    mach.close();
    return 0;
}

START 100
LOOP   MOVER AREG, NUM
       ADD   AREG, ONE
       MOVEM AREG, NUM
       DC    5
ONE    DC    1
       END
